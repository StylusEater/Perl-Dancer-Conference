#!/usr/bin/env perl

use warnings;
use strict;

use Dancer ':script';
use Dancer::Plugin::Interchange6;

set logger        => 'console';
set logger_format => '%m';

my $schema = shop_schema;

shop_schema->deploy( { add_drop_table => 1 } );

my $rset_media_types = $schema->resultset('MediaType');

$rset_media_types->populate( [ { type => 'image' }, { type => 'video' }, ] );

my $media_type_image = $rset_media_types->find( { type => 'image' } );

# username/email, forename, surname, nick, pause id, company, city, state iso,
# country iso, bio, photo
my @users = (
    [
        'xsawyerx@gmail.com', 'SawyerX', '', 'SawyerX', 'XSAWYERX',
        'Booking.com', 'Amsterdam', undef, 'NL',
"One of the Dancer authors and a great speaker, SawyerX is joining us this year in Vienna. Along with Andrew Solomon he is giving a Dancer training on the first day of the conference, along with a talk on one of the conference days. Sawyer is very easy to listen to, and this is an exceptional opportunity to attend training from the guy who not only wrote Dancer, but is also really good at explaining things.",
        'sawyerx.png',
    ],
    [
        'andrew@geekuni.com', 'Andrew', 'Solomon', 'illy', 'ILLY',
        'Geekuni',            'London', undef,     'GB',
"Software developer and project leader with over 15 years experience. Applications include algebraic and optimisation algorithms, web services and virtual machines in Perl, Java and C within a Unix environment. Managing projects using both in-house and contract developers.

        Specialties:Perl, E-Learning, Optimization, Mathematics, Computer Science, mod_perl, lecturer, linux, dbi, javascript, OO Design, MySQL, PostgreSQL ",
        'andrew-solomon.jpg',
    ],
    [
        'andrew@pullingshots.ca', 'Andrew', 'Baerg', undef, 'BAERGAJ',
        'SOLE.com', 'Vancouver', 'BC', 'CA',
        "Andrew graduated from the University of Calgary in 2001 with a Comp Sci degree.He was short after hired on to develop a webstore for Edge Marketing (dba SOLE) in 2001 and went on to open source all of their internal systems. He is currently serving as their CHO (chief hackining officer).",
        'andrew-baerg.jpg',
    ],
    [
        'racke@linuxia.de', 'Stefan',   'Hornburg', 'Racke', 'HORNBURG',
        'Linuxia',          'Hannover', undef,      'DE',
        "Stefan is doing E-Commerce and web app development for more than 15 years. He is also volunteering as Debian maintainer. He has written a bunch of Perl modules and as a true open source enthusiast often commits to community.",
        'stefan-hornburg.jpg',
    ],
    [
        'peter@sysnix.com', 'Peter', 'Mottram', 'SysPete', 'SYSPETE',
        'Sysnix',           'Qormi', undef,     'MT',
        "e-commerce and Perl developer, Linux, network, firewall and security consultant, Peter has lived and worked in several coutries across Europe since his first IT job as sysadmin at Nokia some 25 years ago. Has since worked for mobile and fixed telcos and spent the last 15 years building Internet-connected platforms for the oil and gas industry, truck telematics, massive online games and many other applications",
        'peter-mottram.jpg',
    ],
    [
        'jure.kodzoman@informastudio.com', 'Jure',
        'Kodzoman',                        undef, '',
        'Informa Studio Ltd.',             'Split',
        undef,                             'HR',
        "Jure works as Head of Development at Informa Studio. He has more than 10 years of active experience in E-Commerce working with different types of clients, from small webshops to large corporations. Strong interest in improving usability and effectiveness of online shopping.",
        'jure-kodzoman.jpg'
    ],
    [
        'grega.pompe@informa.si', 'Grega',
        'Pompe',                  undef, '',
        'Informa Studio Ltd.',    'Ljubljana',
        undef,                    'SI',
        "Grega started out as a Python developer but due to circumstances moved to Perl. He is one of the major contributors to TableEditor and Storemail projects as well as a huge DBIx::Class fan.",
        'grega-pompe.jpg',
    ],
    [
        'sbatschelet@mac.com', 'Sam',
        'Batschelet',          'hexfusion', '',
        'West Branch Angler',  'New York',
        'NY',                  'US',
        "Sam is CTO of West Branch Angler fishing resort, taking care of tech department of the resort as well as running their fly fishing gear online store.",
        'sam-batschelet.jpg',
    ],
);
foreach my $row (@users) {
    my $state = shop_state( { state_iso_code => $row->[7] } );
    my $mime_type = $row->[10];
    $mime_type =~ s/^.+\./image\//;

    my $user = shop_user->create(
        {
            username   => $row->[0],
            email      => $row->[0],
            first_name => $row->[1],
            last_name  => $row->[2],
            nickname   => $row->[3],
            pause_id   => $row->[4],
            bio        => $row->[9],
            password   => 'ietoYoo9Ue',
            addresses  => [
                {
                    type             => 'primary',
                    company          => $row->[5],
                    city             => $row->[6],
                    states_id        => $state ? $state->id : undef,
                    country_iso_code => $row->[8],
                }
            ],
            photo => {
                file           => "img/people/" . $row->[10],
                uri            => "/img/people/" . $row->[10],
                mime_type      => $mime_type,
                media_types_id => $media_type_image->id,
            },
        }
    );
}

shop_product->create(
    {
        sku => '2015CONF',
        price => 159,
        name => 'Conference Only',
        description => "Valid for 2 conference days

        21 and 22 of October

        Entrance to all talks

        Includes social event

        Includes free T-Shirt"
    }
);
shop_product->create(
    {
        sku => '2015FULL',
        price => 249,
        name => 'Conference + Training',
        description => "Four Day Full Access

        21 and 22 of October

        Entrance to all talks

        Includes social event

        Includes free T-Shirt"
    }
);

my $nav = shop_navigation->populate(
    [
        [qw/uri type scope name priority description/],
        [ '', 'nav', 'menu-main', 'Home', 100, '' ],
        [
            'speakers', 'nav', 'menu-main', 'Speakers', 80,
            'Meet Our Speakers!'
        ],
        [
            'talks', 'nav', 'menu-main', 'Schedule', 60,
            'Schedule draft. Contains talks confirmed so far.'
        ],
        [
            'tickets', 'nav', 'menu-main', 'Tickets', 40,
            "Get Your Seat Before It's Too Late"
        ],
        [
            'talks/submit', 'nav', 'menu-main', 'Call For Papers',
            20, 'Requirement and guidance for submitting talks'
        ],
        [ 'login',  'nav', 'top-login',  'Login/Register', 1, 'Login' ],
        [ 'logout', 'nav', 'top-logout', 'Logout',         1, 'Logout' ],
    ]
);

shop_schema->resultset('Talk')->create(
    {
        author_id => shop_user({ username => 'andrew@geekuni.com'})->id,
        duration  => 240,
        start_time =>
          DateTime->new( year => 2015, month => 10, day => 19, hour => 9 ),
        title => 'Web development using Dancer',
        tags => 'Dancer',
        abstract => q(A hands-on training session to develop a website with dynamic content in Dancer.

From doing the exercises you will learn to use the Dancer framework, learn to use Template Toolkit, understand the concept of Model-View-Controller, experience structuring code for maintainability, experience using object oriented modules. To attend this session you should have basic knowledge of Perl (but you can join if you have any programming experience), and you should be able to use Linux command line and text editor (like vi/emacs/pico).),
        accepted => 1,
    }
);
shop_schema->resultset('Talk')->create(
    {
        author_id => shop_user({ username => 'racke@linuxia.de'})->id,
        duration  => 40,
        title => 'Template Flute',
        tags => 'Dancer',
        abstract => 'Flutey flute',
        accepted => 1,
    }
);
shop_schema->resultset('Talk')->create(
    {
        author_id => shop_user({ username => 'peter@sysnix.com'})->id,
        duration  => 20,
        start_time =>
          DateTime->new( year => 2015, month => 10, day => 21, hour => 14 ),
        title => 'Dancing on the roof',
        tags => 'Dancer',
        abstract => 'More Dancer',
        accepted => 1,
    }
);
